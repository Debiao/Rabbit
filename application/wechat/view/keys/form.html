{extend name='admin@main'}

{block name="style"}
<style>
    .keys-container .input-group-addon{top:0;right:0;color:#eee;width:25px;padding:7px;position:absolute;margin-top:-1px;text-align:center;background:#393D49}
    .keys-container [data-tips-image]{width:112px;height:auto}
    .keys-container .layui-card{width:580px;height:578px;position:absolute;border:1px solid #ccc}
    .keys-container .layui-card .layui-card-body{height:515px;padding-right:50px}
</style>
{/block}

{block name="content"}
   <div class="nowrap think-box-shadow" ">
       <form class="layui-form" onsubmit="return false" autocomplete="off" data-auto="true" action="{:request()->url()}" method="post">
           <div class="layui-card relative">
               <div class="layui-card-header layui-bg-gray text-center">上传类型</div>
               <div class="layui-card-body" style="height: 500px>
                   {if !isset($vo.keys) or ($vo.keys neq 'default' and $vo.keys neq 'subscribe')}
                   <div class="layui-form-item margin-top-10">
                       <label class="layui-form-label">关 键 字</label>
                       <div class="layui-input-block">
                           <input required placeholder='请输入关键字' maxlength='20' name='keys' class="layui-input" value='{$vo.keys|default=""}'>
                       </div>
                   </div>
                   {else}
                   <input type="hidden" name="keys" value="{$vo.keys|default=''}">
                   {/if}

                   <div class="layui-form-item" data-keys-type='image'>
                       <label class="layui-form-label label-required">包地址</label>
                       <div class="layui-input-block">
                           <input class="layui-input" onchange="$(this).nextAll('img').attr('src', this.value)" value="{$vo.image_url|default=$defaultImage}" name="image_url" required placeholder="请上传包或输入包URL地址">
                           <a data-file="btn" data-type="bmp,png,jpeg,jpg,gif" data-field="image_url" class="input-group-addon"><i class="layui-icon layui-icon-upload"></i></a>
                           <p class="help-block">文件最大100Mb</p>
                       </div>
                   </div>

                   <div class="text-center padding-bottom-10  full-width" style="bottom:0;margin-left:-15px">
                       <div class="hr-line-dashed margin-top-10 margin-bottom-10 margin-left-30"></div>
                       <button class="layui-btn menu-submit margin-left-30">保存数据</button>
                   </div>

               </div>
           </div>
       </form>
   </div>
</div>
{/block}

{block name="script"}
<script>

   $(function () {

       var $body = $('body');
       
       // 图片显示预览
       $body.off('change', '[name="image_url"]').on('change', '[name="image_url"]', function () {
           showReview({type: 'image', content: this.value});
       });

       // 图片显示预览
       $body.off('change', '[name="voice_url"]').on('change', '[name="voice_url"]', function () {
           showReview({type: 'voice', content: this.value});
       });

       // 默认类型事件
       $body.off('click', 'input[name=type]').on('click', 'input[name=type]', function () {
           var value = $(this).val(), $form = $(this).parents('form');
           if (value === 'customservice') value = 'text';
           var $current = $form.find('[data-keys-type="' + value + '"]').removeClass('layui-hide');
           $form.find('[data-keys-type]').not($current).addClass('layui-hide');
           switch (value) {
               case 'news':
                   return $('[name="news_id"]').trigger('change');
               case 'text':
                   return $('[name="content"]').trigger('change');
               case 'image':
                   return $('[name="image_url"]').trigger('change');
               case 'video':
                   return $('[name="video_url"]').trigger('change');
               case 'music':
                   return $('[name="music_url"]').trigger('change');
               case 'voice':
                   return $('[name="voice_url"]').trigger('change');
               case 'customservice':
                   return $('[name="content"]').trigger('change');
           }
       });

       // 默认事件触发
       $('input[name=type]:checked').map(function () {
           $(this).trigger('click');
       });

   });
</script>
{/block}